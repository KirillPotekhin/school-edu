<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –¥–µ—Ç–µ–π</title>
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0px 30px;
            margin: 0;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        h1 {
            text-align: center;
            font-size: 1.8em;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            height: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .menu {
            position: absolute;
            top: 5px;
            left: 20px;
            height: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: #fff;
            cursor: pointer;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        .modal {
            background: white;
            width: 80%;
            max-width: 300px;
            height: 50vh;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }
        .modal-header {
            background: #667eea;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 1.2em;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
            color: white;
            cursor: pointer;
        }
        .modal-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .modal-content button {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .modal-content button.active {
            box-shadow: 0 0 8px rgba(0,0,0,0.4);
        }
        .header {
            text-align: center;
            font-size: 1.3em;
            color: #fff;
            margin-bottom: 10px;
        }
        .level-selector {
            text-align: center;
            margin: 10px 0;
        }
        .level-selector button {
            margin: 0 5px;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            cursor: pointer;
        }
        .level-selector button.active {
            box-shadow: 0 0 8px rgba(0,0,0,0.4);
        }
        .example {
            margin: 8px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 1.1em;
            text-align: center;
        }
        .example input {
            width: 60px;
            height: 30px;
            font-size: 1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            text-align: center;
            -webkit-appearance: none;
            appearance: none;
            inputmode: numeric;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            margin: 10px 0 20px 0;
            overflow: visible;
            position: relative;
        }
        .progress-bar-fill {
            height: 100%;
            background: #e666ea;
            width: 0%;
            transition: width 0.5s;
            border-radius: 10px;
        }
        .progress-icon {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%) translateX(25px);
            background: #fecfff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 6px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
        .progress-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        .button-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: #667eea;
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action-button:hover {
            transform: scale(1.05);
        }
        .action-button i {
            font-size: 1.2em;
            margin-right: 5px;
        }
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        .result-message {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            text-align: center;
            font-size: 1.5em;
            color: #667eea;
        }
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            animation: explode 5s ease-in-out;
        }
        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(20); opacity: 0.5; }
            100% { transform: scale(40); opacity: 0; }
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="menu" onclick="toggleMenu()">‚ò∞</div>
    <div class="modal-overlay" id="modalOverlay" onclick="closeMenu()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">–ú–µ–Ω—é
                <div class="modal-close" onclick="closeMenu()">√ó</div>
            </div>
            <div class="modal-content">
                <button id="multiplyBtn" onclick="setTab('multiply')">–£–º–Ω–æ–∂–µ–Ω–∏–µ/–î–µ–ª–µ–Ω–∏–µ</button>
                <button id="additionBtn" onclick="setTab('addition')">–°–ª–æ–∂–µ–Ω–∏–µ/–í—ã—á–∏—Ç–∞–Ω–∏–µ</button>
                <button id="multiBtn" onclick="setTab('multi')">–ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ</button>
            </div>
        </div>
    </div>
    <h1>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h1>
    <div class="header" id="header"></div>
    <div class="level-selector" id="levelSelector"></div>
    <div class="progress-bar">
        <div class="progress-bar-fill" id="progressFill"></div>
        <div class="progress-icon" id="rocket">
            <img src="/Users/kirill/Sites/school-edu/img/goose.png" alt="–ì—É—Å—å">
        </div>
    </div>
    <div id="examples"></div>
    <div class="button-row">
        <button onclick="checkAll()" class="action-button"><i class="fas fa-check"></i> –ü—Ä–æ–≤–µ—Ä–∫–∞</button>
        <button onclick="generateExamples()" class="action-button"><i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <div class="result-overlay" id="resultOverlay">
        <div class="result-message" id="resultMessage"></div>
        <div id="fireworks"></div>
    </div>

    <script>
        let currentTab = 'multiply';
        let currentLevel = 1;
        let examples = [];

        function toggleMenu() {
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function closeMenu() {
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function setTab(tab) {
            currentTab = tab;
            closeMenu();
            updateHeader();
            generateLevelSelector();
            generateExamples();
            document.getElementById('multiplyBtn').classList.remove('active');
            document.getElementById('additionBtn').classList.remove('active');
            document.getElementById('multiBtn').classList.remove('active');
            document.getElementById(tab + 'Btn').classList.add('active');
        }

        function setLevel(level) {
            currentLevel = level;
            generateExamples();
            document.querySelectorAll('.level-selector button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.level-selector button[data-level="${level}"]`).classList.add('active');
        }

        function updateHeader() {
            const header = document.getElementById('header');
            if (currentTab === 'multi') {
                header.textContent = `–ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ`;
            } else {
                header.textContent = currentTab === 'multiply' ? '–£–º–Ω–æ–∂–µ–Ω–∏–µ/–î–µ–ª–µ–Ω–∏–µ' : '–°–ª–æ–∂–µ–Ω–∏–µ/–í—ã—á–∏—Ç–∞–Ω–∏–µ';
            }
        }

        function generateLevelSelector() {
            const selector = document.getElementById('levelSelector');
            if (currentTab === 'multi') {
                selector.innerHTML = `
                    <button onclick="setLevel(1)" data-level="1">–õ–µ–≥–∫–∏–π</button>
                    <button onclick="setLevel(2)" data-level="2">–°—Ä–µ–¥–Ω–∏–π</button>
                    <button onclick="setLevel(3)" data-level="3">–°–ª–æ–∂–Ω—ã–π</button>
                `;
            } else {
                selector.innerHTML = '';
            }
        }

        function isValidMultiExample(expression) {
            const steps = expression.replace(/\s+/g, ' ').trim().split(' ');
            let result = 0;
            let op = '+';
            let inBrackets = false;
            let usedOpsOutside = new Set();

            for (let i = 0; i < steps.length; i++) {
                const token = steps[i];
                if (token === '(') {
                    inBrackets = true;
                } else if (token === ')') {
                    inBrackets = false;
                } else if (token === '+' || token === '-' || token === '*' || token === '/') {
                    if (inBrackets && (token === '*' || token === '/')) return false;
                    if (!inBrackets) usedOpsOutside.add(token);
                    op = token;
                } else {
                    const num = parseInt(token);
                    if (op === '+') {
                        result = result + num;
                    } else if (op === '-') {
                        result = result - num;
                    } else if (op === '*') {
                        result = result * num;
                    } else if (op === '/') {
                        if (result % num !== 0 || result / num > 10) return false;
                        result = result / num;
                    }
                    if (result < 0) return false;
                }
            }
            return usedOpsOutside.size === Array.from(usedOpsOutside).length;
        }

        function generateExamples() {
            const container = document.getElementById('examples');
            container.innerHTML = '';
            examples = [];
            const count = currentTab === 'multi' ? 4 : 10;
            const used = new Set();

            for (let i = 0; i < count; i++) {
                let expression, correct;
                let attempts = 0;
                while (attempts < 100) {
                    attempts++;
                    expression = null;
                    correct = null;

                    if (currentTab === 'multiply') {
                        let op = Math.random() < 0.5 ? '*' : '/';
                        let a = Math.floor(Math.random() * 10) + 1;
                        let b = Math.floor(Math.random() * 10) + 1;
                        if (op === '/') {
                            if (a % b !== 0) continue;
                            correct = a / b;
                        } else {
                            correct = a * b;
                        }
                        expression = `${a} ${op} ${b}`;
                    } else if (currentTab === 'addition') {
                        let op = Math.random() < 0.5 ? '+' : '-';
                        let a = Math.floor(Math.random() * 20);
                        let b = Math.floor(Math.random() * 20);
                        if (op === '-' && a < b) continue;
                        correct = eval(`${a} ${op} ${b}`);
                        expression = `${a} ${op} ${b}`;
                    } else if (currentTab === 'multi') {
                        let a = Math.floor(Math.random() * 10) + 1;
                        let b = Math.floor(Math.random() * 10) + 1;
                        let c = Math.floor(Math.random() * 10) + 1;
                        let d = Math.floor(Math.random() * 10) + 1;
                        let e = Math.floor(Math.random() * 10) + 1;
                        let f = Math.floor(Math.random() * 10) + 1;
                        let g = Math.floor(Math.random() * 10) + 1;

                        let op1 = Math.random() < 0.5 ? '+' : '-';
                        let op2 = Math.random() < 0.5 ? '+' : '-';
                        let op3 = Math.random() < 0.5 ? '+' : '-';
                        let op4 = Math.random() < 0.5 ? '+' : '-';
                        let op5 = Math.random() < 0.5 ? '+' : '-';
                        let op6 = Math.random() < 0.5 ? '+' : '-';
                        let opOutside = Math.random() < 0.5 ? '*' : '/';

                        if (currentLevel === 1) {
                            expression = `${a} ${op1} ${b} ${op2} (${c} ${op3} ${d}) ${op4} ${e}`;
                        } else if (currentLevel === 2) {
                            expression = `(${a} ${op1} ${b}) ${op2} ${c} ${op3} ${d} ${op4} ${e}`;
                        } else {
                            expression = `(${a} ${op1} ${b}) ${op2} (${c} ${op3} ${d}) ${op4} ${e} ${op5} ${f} ${op6} ${g}`;
                        }

                        if (opOutside === '/') {
                            let divisor = f;
                            let dividend = e;
                            if (dividend < divisor) {
                                dividend = divisor * Math.floor(Math.random() * 10) + divisor;
                            }
                            while (dividend <= 100 && dividend % divisor !== 0) {
                                dividend += 1;
                            }
                            if (dividend > 100 || dividend / divisor > 10) continue;
                            e = dividend;
                        }

                        if (opOutside === '*') {
                            expression = expression.replace(`${f}`, `${f} * ${g}`);
                        } else if (opOutside === '/') {
                            expression = expression.replace(`${f}`, `${f} / ${g}`);
                        }

                        try {
                            correct = eval(expression.replace(/\s+/g, ''));
                        } catch (e) {
                            continue;
                        }

                        if (correct < 0 || !isValidMultiExample(expression)) continue;
                    }

                    if (expression && !used.has(expression)) {
                        used.add(expression);
                        break;
                    }
                }

                if (!expression) {
                    expression = `${i + 2} + ${i + 3} + ${i + 4}`;
                    correct = (i + 2) + (i + 3) + (i + 4);
                }

                const exampleDiv = document.createElement('div');
                exampleDiv.className = 'example';
                exampleDiv.innerHTML = `${expression} = <input type="number" data-correct="${correct}" data-checked="false" oninput="updateProgress()">`;
                container.appendChild(exampleDiv);
                examples.push({ div: exampleDiv, correct: correct });
            }
            updateProgress();
        }

        function checkAll() {
            let correctCount = 0;
            examples.forEach(item => {
                const input = item.div.querySelector('input');
                const correct = parseInt(input.dataset.correct);
                const user = parseInt(input.value) || 0;
                if (user === correct) {
                    item.div.classList.add('correct');
                    item.div.classList.remove('incorrect');
                    correctCount++;
                } else {
                    item.div.classList.add('incorrect');
                    item.div.classList.remove('correct');
                }
            });
            const percent = (correctCount / examples.length) * 100;
            const overlay = document.getElementById('resultOverlay');
            const message = document.getElementById('resultMessage');
            overlay.style.display = 'flex';
            if (percent === 100) {
                message.textContent = 'üéâ –£—Ä–∞! 100%';
            } else if (percent >= 80) {
                message.textContent = 'üëè –û—Ç–ª–∏—á–Ω–æ! 80%';
            } else if (percent >= 70) {
                message.textContent = 'üí™ –•–æ—Ä–æ—à–æ! 70%';
            } else {
                message.textContent = '–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑';
            }
            launchFireworks();
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 3000);
        }

        function launchFireworks() {
            const fireworks = document.getElementById('fireworks');
            fireworks.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = Math.random() * 100 + '%';
                firework.style.top = Math.random() * 100 + '%';
                firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                fireworks.appendChild(firework);
            }
        }

        function updateProgress() {
            const filled = examples.filter(item => item.div.querySelector('input').value !== '').length;
            const total = examples.length;
            const percent = total ? (filled / total) * 100 : 0;
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('rocket').style.right = (100 - percent) + '%';
            document.getElementById('rocket').style.transform = 'translateY(-50%) translateX(25px)';
            document.getElementById('rocket').style.left = 'auto';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        setTab('multiply');
        document.getElementById('progressFill').style.width = '0%';
        document.getElementById('rocket').style.right = '100%';
        document.getElementById('rocket').style.transform = 'translateY(-50%) translateX(25px)';
        document.getElementById('rocket').style.left = 'auto';
    </script>
</body>
</html>
