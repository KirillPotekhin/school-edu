<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –¥–µ—Ç–µ–π</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    :root{
      --pad: 12px;
      --keypad-h: 240px;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 0 var(--pad);
      margin: 0;
      color: #333;
      height: 100dvh;
      overflow: hidden;
    }

    h1 {
      text-align: center;
      font-size: 1.8em;
      color: #fff;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      margin: 10px 0 6px 0;
      height: 1.8em;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .menu {
      position: absolute;
      top: 5px;
      left: 12px;
      height: 1.8em;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5em;
      color: #fff;
      cursor: pointer;
      user-select: none;
    }

    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      justify-content: center;
      align-items: center;
    }
    .modal {
      background: white;
      width: 80%;
      max-width: 300px;
      height: 50vh;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      overflow: hidden;
      position: relative;
    }
    .modal-header {
      background: #667eea;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 1.2em;
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.2em;
      color: white;
      cursor: pointer;
    }
    .modal-content {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .modal-content button {
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      background: #667eea;
      color: white;
      cursor: pointer;
      font-size: 0.95em;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .modal-content button.active {
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
    }

    .header {
      text-align: center;
      font-size: 1.1em;
      color: #fff;
      margin-bottom: 8px;
    }

    .level-selector {
      text-align: center;
      margin: 6px 0 8px 0;
    }
    .level-selector button {
      margin: 0 5px;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: #667eea;
      color: white;
      cursor: pointer;
    }
    .level-selector button.active {
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      margin: 8px 0 12px 0;
      overflow: visible;
      position: relative;
    }
    .progress-bar-fill {
      height: 100%;
      background: #e666ea;
      width: 0%;
      transition: width 0.5s;
      border-radius: 10px;
    }
    .progress-icon {
      position: absolute;
      top: 50%;
      right: 0;
      transform: translateY(-50%) translateX(25px);
      background: #fecfff;
      border-radius: 50%;
      width: 46px;
      height: 46px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 6px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }
    .progress-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    /* –ü—Ä–∏–º–µ—Ä—ã ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–∞—è –∑–æ–Ω–∞ */
    #examples{
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      height: calc(100dvh - 52px - 34px - 46px - 12px - 58px - var(--keypad-h));
      padding-bottom: 10px;
    }

    .example {
      margin: 8px 0;
      padding: 10px;
      background: rgba(255, 255, 255, 0.92);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      font-size: 1.05em;
      text-align: center;

      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      user-select: none;
      cursor: pointer;
    }

    .example .expr{
      max-width: 100%;
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 4px;
    }

    .example input {
      width: 84px;
      height: 42px;
      font-size: 20px;
      border: 2px solid #667eea;
      border-radius: 12px;
      text-align: center;
      background: #fff;
    }

    .example.correct { outline: 3px solid rgba(0, 200, 0, 0.35); }
    .example.incorrect { outline: 3px solid rgba(255, 0, 0, 0.30); }

    .button-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 10px 0 0 0;
      padding-bottom: calc(var(--keypad-h) + 10px); /* —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∏ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–ª–∏—Å—å –ø–∞–Ω–µ–ª—å—é */
    }

    .action-button {
      padding: 10px 18px;
      border: none;
      border-radius: 20px;
      background: #667eea;
      color: white;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s;
      font-size: 1em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .action-button:hover { transform: scale(1.03); }

    .result-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .result-message {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      text-align: center;
      font-size: 1.5em;
      color: #667eea;
    }
    .firework {
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      animation: explode 5s ease-in-out;
    }
    @keyframes explode {
      0% { transform: scale(0); opacity: 1; }
      50% { transform: scale(20); opacity: 0.5; }
      100% { transform: scale(40); opacity: 0; }
    }

    /* –¶–∏—Ñ—Ä–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–Ω–∏–∑—É */
    .keypad{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: var(--keypad-h);
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
      z-index: 999;
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      box-shadow: 0 -6px 20px rgba(0,0,0,0.15);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .keypad button{
      border: none;
      border-radius: 14px;
      font-size: 22px;
      padding: 14px 0;
      background: #667eea;
      color: #fff;
      cursor: pointer;
    }
    .keypad button.secondary{ background: #764ba2; }
  </style>
</head>

<body>
  <div class="menu" onclick="toggleMenu()">‚ò∞</div>

  <div class="modal-overlay" id="modalOverlay" onclick="closeMenu()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">–ú–µ–Ω—é
        <div class="modal-close" onclick="closeMenu()">√ó</div>
      </div>
      <div class="modal-content">
        <button id="multiplyBtn" onclick="setTab('multiply')">–£–º–Ω–æ–∂–µ–Ω–∏–µ/–î–µ–ª–µ–Ω–∏–µ</button>
        <button id="additionBtn" onclick="setTab('addition')">–°–ª–æ–∂–µ–Ω–∏–µ/–í—ã—á–∏—Ç–∞–Ω–∏–µ</button>
        <button id="multiBtn" onclick="setTab('multi')">–ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ</button>
      </div>
    </div>
  </div>

  <h1>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h1>
  <div class="header" id="header"></div>
  <div class="level-selector" id="levelSelector"></div>

  <div class="progress-bar">
    <div class="progress-bar-fill" id="progressFill"></div>
    <div class="progress-icon" id="rocket">
      <img src="img/goose.png" alt="–ì—É—Å—å">
    </div>
  </div>

  <div id="examples"></div>

  <div class="button-row">
    <button onclick="checkAll()" class="action-button"><i class="fas fa-check"></i>–ü—Ä–æ–≤–µ—Ä–∫–∞</button>
    <button onclick="generateExamples()" class="action-button"><i class="fas fa-sync-alt"></i>–û–±–Ω–æ–≤–∏—Ç—å</button>
  </div>

  <div class="result-overlay" id="resultOverlay">
    <div class="result-message" id="resultMessage"></div>
    <div id="fireworks"></div>
  </div>

  <!-- –¶–∏—Ñ—Ä–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="keypad" id="keypad">
    <button onclick="kp('1')">1</button>
    <button onclick="kp('2')">2</button>
    <button onclick="kp('3')">3</button>
    <button onclick="kp('4')">4</button>
    <button onclick="kp('5')">5</button>
    <button onclick="kp('6')">6</button>
    <button onclick="kp('7')">7</button>
    <button onclick="kp('8')">8</button>
    <button onclick="kp('9')">9</button>
    <button class="secondary" onclick="kpBack()">‚å´</button>
    <button onclick="kp('0')">0</button>
    <button class="secondary" onclick="kpClear()">C</button>
  </div>

  <script>
    let currentTab = 'multiply';
    let currentLevel = 1;
    let examples = [];
    let activeInput = null;

    function toggleMenu() {
      document.getElementById('modalOverlay').style.display = 'flex';
    }

    function closeMenu() {
      document.getElementById('modalOverlay').style.display = 'none';
    }

    function setTab(tab) {
      currentTab = tab;
      closeMenu();
      updateHeader();
      generateLevelSelector();
      generateExamples();

      // –∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é
      document.getElementById('multiplyBtn').classList.remove('active');
      document.getElementById('additionBtn').classList.remove('active');
      document.getElementById('multiBtn').classList.remove('active');
      const btnId = tab === 'multiply' ? 'multiplyBtn' : tab === 'addition' ? 'additionBtn' : 'multiBtn';
      document.getElementById(btnId).classList.add('active');
    }

    function setLevel(level) {
      currentLevel = level;
      generateExamples();
      document.querySelectorAll('.level-selector button').forEach(btn => btn.classList.remove('active'));
      const b = document.querySelector(`.level-selector button[data-level="${level}"]`);
      if (b) b.classList.add('active');
    }

    function updateHeader() {
      const header = document.getElementById('header');
      if (currentTab === 'multi') header.textContent = `–ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ`;
      else header.textContent = currentTab === 'multiply' ? '–£–º–Ω–æ–∂–µ–Ω–∏–µ/–î–µ–ª–µ–Ω–∏–µ' : '–°–ª–æ–∂–µ–Ω–∏–µ/–í—ã—á–∏—Ç–∞–Ω–∏–µ';
    }

    function generateLevelSelector() {
      const selector = document.getElementById('levelSelector');
      if (currentTab === 'multi') {
        selector.innerHTML = `
          <button onclick="setLevel(1)" data-level="1">–õ–µ–≥–∫–∏–π</button>
          <button onclick="setLevel(2)" data-level="2">–°—Ä–µ–¥–Ω–∏–π</button>
          <button onclick="setLevel(3)" data-level="3">–°–ª–æ–∂–Ω—ã–π</button>
        `;
        // –≤—ã–¥–µ–ª–∏–º —Ç–µ–∫—É—â–∏–π
        setTimeout(() => {
          const b = document.querySelector(`.level-selector button[data-level="${currentLevel}"]`);
          if (b) b.classList.add('active');
        }, 0);
      } else {
        selector.innerHTML = '';
      }
    }

    function isValidMultiExample(expression) {
      const steps = expression.replace(/\s+/g, ' ').trim().split(' ');
      let result = 0;
      let op = '+';
      let inBrackets = false;

      for (let i = 0; i < steps.length; i++) {
        const token = steps[i];
        if (token === '(') inBrackets = true;
        else if (token === ')') inBrackets = false;
        else if (token === '+' || token === '-' || token === '*' || token === '/') {
          if (inBrackets && (token === '*' || token === '/')) return false;
          op = token;
        } else {
          const num = parseInt(token);
          if (Number.isNaN(num)) continue;

          if (op === '+') result = result + num;
          else if (op === '-') result = result - num;
          else if (op === '*') result = result * num;
          else if (op === '/') {
            if (num === 0) return false;
            if (result % num !== 0 || result / num > 10) return false;
            result = result / num;
          }
          if (result < 0) return false;
        }
      }
      return true;
    }

    function generateExamples() {
      const container = document.getElementById('examples');
      container.innerHTML = '';
      examples = [];
      activeInput = null;

      const count = currentTab === 'multi' ? 4 : 10;
      const used = new Set();

      for (let i = 0; i < count; i++) {
        let expression = null, correct = null;
        let attempts = 0;

        while (attempts < 120) {
          attempts++;

          if (currentTab === 'multiply') {
            // —Å—Ç—Ä–æ–≥–æ —Ç–∞–±–ª–∏—Ü–∞ –¥–æ 10: –¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–µ–ª–∏—Ç—Å—è –Ω–∞—Ü–µ–ª–æ
            const op = Math.random() < 0.5 ? '*' : '/';
            let a = Math.floor(Math.random() * 10) + 1;
            let b = Math.floor(Math.random() * 10) + 1;

            if (op === '/') {
              // —Å–¥–µ–ª–∞–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã –¥–µ–ª–∏–ª–æ—Å—å: a = b*k
              const k = Math.floor(Math.random() * 10) + 1;
              a = b * k;
              correct = k;
            } else {
              correct = a * b;
            }
            expression = `${a} ${op} ${b}`;
          }

          else if (currentTab === 'addition') {
            const op = Math.random() < 0.5 ? '+' : '-';
            let a = Math.floor(Math.random() * 20);
            let b = Math.floor(Math.random() * 20);
            if (op === '-' && a < b) continue;
            correct = op === '+' ? a + b : a - b;
            expression = `${a} ${op} ${b}`;
          }

          else if (currentTab === 'multi') {
            // –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ: —Ç–æ–ª—å–∫–æ + –∏ -, —Å–∫–æ–±–∫–∏, –±–µ–∑ —É–º–Ω–æ–∂/–¥–µ–ª –≤–Ω—É—Ç—Ä–∏ —Å–∫–æ–±–æ–∫
            let a = Math.floor(Math.random() * 10) + 1;
            let b = Math.floor(Math.random() * 10) + 1;
            let c = Math.floor(Math.random() * 10) + 1;
            let d = Math.floor(Math.random() * 10) + 1;
            let e = Math.floor(Math.random() * 10) + 1;

            const op1 = Math.random() < 0.5 ? '+' : '-';
            const op2 = Math.random() < 0.5 ? '+' : '-';
            const op3 = Math.random() < 0.5 ? '+' : '-';
            const op4 = Math.random() < 0.5 ? '+' : '-';

            if (currentLevel === 1) {
              expression = `${a} ${op1} ${b} ${op2} (${c} ${op3} ${d}) ${op4} ${e}`;
            } else if (currentLevel === 2) {
              expression = `(${a} ${op1} ${b}) ${op2} ${c} ${op3} ${d} ${op4} ${e}`;
            } else {
              let f = Math.floor(Math.random() * 10) + 1;
              let g = Math.floor(Math.random() * 10) + 1;
              const op5 = Math.random() < 0.5 ? '+' : '-';
              const op6 = Math.random() < 0.5 ? '+' : '-';
              expression = `(${a} ${op1} ${b}) ${op2} (${c} ${op3} ${d}) ${op4} ${e} ${op5} ${f} ${op6} ${g}`;
            }

            try {
              correct = eval(expression.replace(/\s+/g, ''));
            } catch (err) {
              continue;
            }
            if (correct < 0) continue;
            if (!isValidMultiExample(expression)) continue;
          }

          if (expression && !used.has(expression)) {
            used.add(expression);
            break;
          }
        }

        if (!expression) {
          expression = `${i + 2} + ${i + 3} + ${i + 4}`;
          correct = (i + 2) + (i + 3) + (i + 4);
        }

        const exampleDiv = document.createElement('div');
        exampleDiv.className = 'example';

        exampleDiv.innerHTML = `
          <span class="expr">${expression} =</span>
          <input
            type="text"
            readonly
            inputmode="none"
            data-correct="${correct}"
            onclick="setActive(this)"
            onfocus="this.blur()"
            placeholder="?"
          >
        `;

        exampleDiv.onclick = () => setActive(exampleDiv.querySelector('input'));

        container.appendChild(exampleDiv);
        examples.push({ div: exampleDiv, correct: correct });
      }

      updateProgress();

      // –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ
      setTimeout(() => {
        const first = document.querySelector('.example input');
        if (first) setActive(first);
      }, 0);
    }

    function setActive(el){
      activeInput = el;
      document.querySelectorAll('.example input').forEach(i => i.style.outline = 'none');
      el.style.outline = '3px solid rgba(102,126,234,0.5)';
    }

    function kp(ch){
      if(!activeInput){
        const firstEmpty = [...document.querySelectorAll('.example input')].find(i => i.value === '');
        if(firstEmpty) setActive(firstEmpty);
        else setActive(document.querySelector('.example input'));
      }
      // –æ–≥—Ä–∞–Ω–∏—á–∏–º –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞ (—á—Ç–æ–±—ã –Ω–µ –Ω–∞–±–∏–≤–∞–ª–∏ —Å–ª—É—á–∞–π–Ω–æ 99999)
      if (activeInput.value.length >= 3) return;
      activeInput.value += ch;
      updateProgress();
    }

    function kpBack(){
      if(!activeInput) return;
      activeInput.value = activeInput.value.slice(0, -1);
      updateProgress();
    }

    function kpClear(){
      if(!activeInput) return;
      activeInput.value = '';
      updateProgress();
    }

    function checkAll() {
      let correctCount = 0;

      examples.forEach(item => {
        const input = item.div.querySelector('input');
        const correct = parseInt(input.dataset.correct);
        const user = parseInt(input.value);

        if (!Number.isNaN(user) && user === correct) {
          item.div.classList.add('correct');
          item.div.classList.remove('incorrect');
          correctCount++;
        } else {
          item.div.classList.add('incorrect');
          item.div.classList.remove('correct');
        }
      });

      const percent = (correctCount / examples.length) * 100;
      const overlay = document.getElementById('resultOverlay');
      const message = document.getElementById('resultMessage');

      overlay.style.display = 'flex';

      if (percent === 100) message.textContent = 'üéâ –£—Ä–∞! 100%';
      else if (percent >= 80) message.textContent = `üëè –û—Ç–ª–∏—á–Ω–æ! ${Math.round(percent)}%`;
      else if (percent >= 70) message.textContent = `üí™ –•–æ—Ä–æ—à–æ! ${Math.round(percent)}%`;
      else message.textContent = `–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑: ${Math.round(percent)}%`;

      launchFireworks();

      setTimeout(() => { overlay.style.display = 'none'; }, 2500);
    }

    function launchFireworks() {
      const fireworks = document.getElementById('fireworks');
      fireworks.innerHTML = '';
      for (let i = 0; i < 20; i++) {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = Math.random() * 100 + '%';
        firework.style.top = Math.random() * 100 + '%';
        firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        fireworks.appendChild(firework);
      }
    }

    function updateProgress() {
      const filled = examples.filter(item => item.div.querySelector('input').value !== '').length;
      const total = examples.length;
      const percent = total ? (filled / total) * 100 : 0;

      document.getElementById('progressFill').style.width = percent + '%';
      document.getElementById('rocket').style.right = (100 - percent) + '%';
      document.getElementById('rocket').style.transform = 'translateY(-50%) translateX(25px)';
      document.getElementById('rocket').style.left = 'auto';
    }

    // init
    setTab('multiply');
    document.getElementById('progressFill').style.width = '0%';
    document.getElementById('rocket').style.right = '100%';
    document.getElementById('rocket').style.transform = 'translateY(-50%) translateX(25px)';
    document.getElementById('rocket').style.left = 'auto';
  </script>
</body>
</html>
